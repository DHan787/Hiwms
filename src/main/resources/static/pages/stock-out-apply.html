<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../assets/css/orders.css">
		<link rel="stylesheet" href="../assets/css/element-ui/index.css">
		<title></title>
	</head>
	<body>
		<div id="app">
			<el-container>
				<el-container>
					<!-- 主体 -->
					<el-main>
						<el-breadcrumb style="margin-bottom: 12px;">
							<el-breadcrumb-item>首页</el-breadcrumb-item>
							<el-breadcrumb-item>业务流</el-breadcrumb-item>
							<el-breadcrumb-item>出库申请</el-breadcrumb-item>
						</el-breadcrumb>
						<!--表单区域-->
						<el-card>
							<!--复选框列-->
							<el-table :data="tableData" stripe style="width: 100%; " @selection-change="selectCall"
								ref="multipleTable">
								<el-table-column type="selection" width="60"></el-table-column>
								<el-table-column prop="goodsName" label="货物名称" width="180">
								</el-table-column>
								<el-table-column prop="goodsNumber" label="货品数量" width="180">
								</el-table-column>
								<el-table-column label="出库数量">
									<template slot-scope="scope">
										<el-input-number size="medium" v-model="scope.row.stockOutNumber" :min="1" :max="1000" label="出库数量" oninput="value=value.replace(/[^\d]/g,'')" placeholder="大于0的整数"></el-input-number>
									</template>
								</el-table-column>
							</el-table>
							<div style="text-align: center;">
								<el-pagination background layout="prev, pager, next" :total="1000"></el-pagination>
							</div>
						</el-card>
						<el-card style="text-align: center;">
							<el-button type="primary" plain @click="apply" icon="el-icon-download">申请出库</el-button>
						</el-card>
					</el-main>
				</el-container>
			</el-container>
		</div>
	</body>
	<script src="../assets/js/vue.js"></script>
	<script src="../assets/css/element-ui/index.js"></script>
	<script src="../assets/js/axios.min.js"></script>

	<script>
		new Vue({
			el: '#app',
			data: function() {
				return {
					tableData: [],
					tableDataSelections: [],
					selectRows: [],
					selectTotal: 0
				}
			},

			created() {
				this.getAll();
			},

			methods: {
				getAll() {
					axios.get("http://localhost:8080/inventory").then(res => {
						this.tableData = res.data;
					});
				},
				selectCall(val) {
					this.tableDataSelections = val;
					console.log(val);
				},
				apply() {
					console.log(this.tableDataSelections);
					console.log(this.tableDataSelections.length);
					var size = this.tableDataSelections.length;
					var item;
					if (size < 1) { //至少选择一个货物
						this.$confirm('请选择至少一个选项！', '提示', {
							confirmButtonText: '确定',
							type: 'warning'
						})
					} else {
						for (var i = 0; i < this.tableDataSelections.length; i++) {
							if ((this.tableDataSelections[i].goodsNumber) < 1) { //数量不能为0
								this.$confirm('出库数量不能为0！', '提示', {
									confirmButtonText: '确定',
									type: 'warning'
								})
							}else{
							//console.log('name:' + this.tableDataSelections[i].goodsName);
							//console.log("tableDataSelections[i]: " + this.tableDataSelections[i]);
							//console.log('number:' + this.tableDataSelections[i].goodsNumber);
							this.tableDataSelections[i].goodsNumber = this.tableDataSelections[i].stockOutNumber;
							item = this.tableDataSelections[i];
							axios.post("http://localhost:8080/stockOut/save",item).then(res=> {
								if(res.data){
										this.$message({
											type: 'success',
											message: '出库成功!'
										});
										this.getAll();										
									}else{
										this.$message({
											type: 'info',
											message: '出库失败'
										});
									}
								})
								}
						}
						
					}
				}
			}
		})
	</script>
</html>
