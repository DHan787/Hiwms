<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../../assets/css/orders.css">
		<link rel="stylesheet" href="../../assets/css/element-ui/index.css">
		<title></title>
	</head>
	<body>
		<div id="app">
			<el-container>
				<el-container>
					<!-- 主体 -->
					<el-main>
						<el-breadcrumb style="margin-bottom: 12px;">
							<el-breadcrumb-item>首页</el-breadcrumb-item>
							<el-breadcrumb-item>业务流</el-breadcrumb-item>
							<el-breadcrumb-item>订单管理</el-breadcrumb-item>

                </el-breadcrumb>

                <!--新建订单区域-->
                <div class="card-container">
                    <div class="handle-container">
                        <!--查询表单-->
                        <el-form :model="search">
                            <el-row>
                                <el-col :span='12'>
                                    <el-form-item >
                                        <el-input v-model="ordersId" clearable placeholder="请输⼊订单编号" style="width:200px;line-height:68px"><!-- clearable 输⼊框可清除属性 --></el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>
                        </el-form>
                    </div>
                        <el-row :span="8" align="right">
                            <el-button type="primary" plain style="margin:15px 20px;" @click="like()" icon="el-icon-search">查询订单</el-button>
                        </el-row>
                    </div>

                <!--表单区域-->
                <el-card>
                    <el-table :data="tableData" stripe style="width: 100%;">
                        <el-table-column prop="orderId" label="订单编号" width="80">
                        </el-table-column>
                        <el-table-column prop="orderType" label="订单类型" width="130" :formatter="formatType">
                        </el-table-column>
                        <el-table-column prop="orderStartTime" label="订单开始时间">
                        </el-table-column>
                        <el-table-column prop="orderEndTime" label=订单结束时间>
                        </el-table-column>
                        <el-table-column prop="orderInit" label="订单创建人" :formatter="formatInit">
                        </el-table-column>
                        <el-table-column prop="orderOperator" label="订单操作员">
                            <template slot-scope="scope">
                                <el-select v-model="scope.row.orderOperator" placeholder="请选择操作员">
                                    <el-option v-for="users in options" :label="users.userName" :value="users.userId" :key="users.userId">
                                    </el-option>
                                </el-select>
                            </template>
                        </el-table-column>
                        <el-table-column prop="orderStatus" label="订单状态" :formatter="formatStatus">
                        </el-table-column>
                        <el-table-column label="操作" width="250" style="display: flex;">
                            <template slot-scope="scope" v-for="orders in tableData">
                                <el-button type="primary" plain @click="checkClick(scope.$index,scope.row)"
                                           icon="el-icon-edit">确认订单</el-button>
                                <el-button type="danger" plain @click="removeOrdersById(scope.$index)"
                                           icon="el-icon-delete">删除</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                    <div style="text-align: center;">
                        <el-pagination background layout="prev, pager, next" :total="1000"></el-pagination>
                    </div>
                </el-card>
            </el-main>
        </el-container>
    </el-container>
</div>
</body>
<script src="../../assets/js/vue.js"></script>
<script src="../../assets/css/element-ui/index.js"></script>
<script src="../../assets/js/axios.min.js"></script>

<script>
    new Vue({
        el: '#app',
        data: function() {
            return {
                tableData: [],
                ordersId:"",
                options:[],//下拉框中的数据
                dialogFormVisible: false,
                dialogFormTitle: "",
                form: {
                    orderID: '',
                    orderType: '',
                    orderStartTime: '',
                    orderEndTime: '',
                    orderInit:'',
                    orderOperator:''
                },
                formLabelWidth: '120px',
            }
        },

			created() {
				this.getAll()
                this.getOperatorName()

			},

			methods: {
				getAll() {
					axios.get("http://localhost:8080/orders").then(res => {
						this.tableData = res.data;
					});
				},
                <!--模糊查询-->
                like(){
                    console.log(1);
                    axios.get("http://localhost:8080/orders/like?ordersId="+this.ordersId).then(res=>{
                        console.log(res);
                        this.tableData = res.data ;
                    });
                },
				getOperatorName(){
					axios.get("http://localhost:8080/users").then(res => {
						this.options = res.data;
					});
				},
				checkClick(index,row) {
					axios.post("http://localhost:8080/orders/check", this.tableData[index]).then(res => {
						if (res.data) {
							// console.log(this.tableData[index]);
							this.$message({
								type: 'success',
								message: '修改成功!'
							});
							this.getAll();
						} else {
							this.$message({
								type: 'info',
								message: '修改失败'
							});
						}
					})
				},
				formatStatus(row) {
					switch (row.orderStatus) {
						case 10:
							return "未入库"
							break
						case 11:
							return "入库中"
							break
						case 12:
							return "已入库"
							break
						case 20:
							return "未出库"
							break
						case 21:
							return "出库中"
							break
						case 12:
							return "已出库"
							break
						default:
							return "未知"
							break
					}
				},
				formatType(row) {
					return row.orderType === 1 ? "入库" : row.orderStatus === 2 ? "出库" : "未填写";
				},
				formatInit(row){
					if(row.orderInit === 11){
						return "管理员Anna"
					}
					else{
						return "未知"
					}
				}

			}
		})
	</script>
</html>
