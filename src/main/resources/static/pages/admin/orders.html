<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../../assets/css/orders.css">
		<link rel="stylesheet" href="../../assets/css/element-ui/index.css">
		<title></title>
	</head>
	<body>
		<div id="app">
			<el-container>
				<el-container>
					<!-- 主体 -->
					<el-main>
						<el-breadcrumb style="margin-bottom: 12px;">
							<el-breadcrumb-item>首页</el-breadcrumb-item>
							<el-breadcrumb-item>业务流</el-breadcrumb-item>
							<el-breadcrumb-item>订单管理</el-breadcrumb-item>

						</el-breadcrumb>
						<!--表单区域-->
						<el-card>
							<el-table :data="tableData" stripe style="width: 100%; ">
								<el-table-column prop="orderId" label="订单编号" width="180">
								</el-table-column>
								<el-table-column prop="orderType" label="订单类型" width="180" :formatter="formatType">
								</el-table-column>
								<el-table-column prop="orderStartTime" label="订单开始时间">
								</el-table-column>
								<el-table-column prop="orderEndTime" label=订单结束时间>
								</el-table-column>
								<el-table-column prop="orderInit" label="订单创建人">
								</el-table-column>
								<el-table-column prop="orderOperator" label="订单操作员">
								</el-table-column>
								<el-table-column prop="orderStatus" label="订单状态" :formatter="formatStatus">
								</el-table-column>
								<el-table-column label="操作" width="250" style="display: flex;">
									<template slot-scope="scope" v-for="orders in tableData">

										<el-button type="primary" plain @click="editClick(scope.$index,scope.row)"
											icon="el-icon-edit">编辑</el-button>
										<el-button type="danger" plain @click="removeOrdersById(scope.$index)"
											icon="el-icon-delete">删除</el-button>
									</template>
								</el-table-column>
							</el-table>
							<div style="text-align: center;">
								<el-pagination background layout="prev, pager, next" :total="1000"></el-pagination>
							</div>
						</el-card>
					</el-main>
				</el-container>
			</el-container>
		</div>
	</body>
	<script src="../../assets/js/vue.js"></script>
	<script src="../../assets/css/element-ui/index.js"></script>
	<script src="../../assets/js/axios.min.js"></script>

	<script>
		new Vue({
			el: '#app',
			data: function() {
				return {
					tableData: [],
					dialogFormVisible: false,
					dialogFormTitle: "",
					form: {
						orderID: '',
						orderType: '',
						orderStartTime: '',
						orderEndTime: '',
						orderInit: '',
						orderOperator: ''
					},
					formLabelWidth: '120px',
					isAdd: false
				}
			},

			created() {
				this.getAll();
			},

			methods: {
				getAll() {
					axios.get("http://localhost:8080/orders").then(res => {
						this.tableData = res.data;
					});
				},

				removeOrdersById(index) {
					var id = this.tableData[index].orderId;
					this.$confirm('此操作将永久删除订单, 是否继续?', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						axios.delete("http://localhost:8080/orders/" + id).then(res => {
							this.getAll();
						});
						this.$message({
							type: 'success',
							message: '删除成功!'
						});
					}).catch(() => {
						this.$message({
							type: 'info',
							message: '已取消删除'
						});
					});
				},
				addClick() {
					this.dialogFormVisible = true;
					this.dialogFormTitle = "新增订单";
					this.isAdd = true;
					this.form = {};
				},
				addOrders() {
					axios.post("http://localhost:8080/orders", this.form).then(rel => {
						if (rel.data) {
							this.$message({
								type: 'success',
								message: '新增成功!'
							});
							this.getAll();
							this.addFormVisible = false;
							this.$refs.form.resetFields();
						} else {
							this.$message({
								type: 'info',
								message: '新增失败'
							});
						}
					})

				},
				editClick(index, row) {
					this.dialogFormVisible = true;
					this.dialogFormTitle = "修改订单信息";
					this.isAdd = false;
					this.form = Object.assign({}, row);
					this.form.index = index;
				},


				updateOrdersById() {
					axios.put("http://localhost:8080/orders", this.form).then(rel => {
						if (rel.data) {
							this.$message({
								type: 'success',
								message: '修改成功!'
							});
							this.getAll();
							this.dialogFormVisible = false;

						} else {
							this.$message({
								type: 'info',
								message: '修改失败'
							});
						}
						this.$refs.form.resetFields();
					})
				},
				formatStatus(row) {
					switch (row.orderStatus) {
						case 10 :
							return "未入库"
							break
						case 11 :
							return "入库中"
							break
						case 12 :
							return "已入库"
							break
						case 20 :
							return "未出库"
							break
						case 21 :
							return "出库中"
							break
						case 12 :
							return "已出库"
							break
						default:
							return "未知"
							break
					}
				},
				formatType(row) {
					return row.orderType === 1 ? "入库" : row.orderStatus === 2 ? "出库" : "未填写";
				},

			}
		})
	</script>
</html>
