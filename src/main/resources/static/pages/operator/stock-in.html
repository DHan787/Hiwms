<!DOCTYPE html>
<html lang="">
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../../assets/css/goods.css">
		<link rel="stylesheet" href="../../assets/css/element-ui/index.css">
		<title></title>
	</head>
	<body>
		<div id="app">
			<el-container>
				<el-container>
					<!-- 主体 -->
					<el-main>
						<el-breadcrumb style="margin-bottom: 12px;">
							<el-breadcrumb-item>首页</el-breadcrumb-item>
							<el-breadcrumb-item>业务流</el-breadcrumb-item>
							<el-breadcrumb-item>入库信息</el-breadcrumb-item>
						</el-breadcrumb>

						<div class="card-container">
							<div class="handle-container">

								<!-- <el-button type="primary" plain style="margin:15px 20px;"  icon="el-icon-search">查询用户</el-button> -->
								<!-- <el-button type="primary" plain style="margin:15px 20px;" @click="addClick" icon="el-icon-plus">新增用户</el-button>
 -->
								<el-dialog :title="dialogFormTitle" :visible.sync="dialogFormVisible">
									<el-table :data="gridData">
										<el-table-column property="stockId" label="库存id" width="150"></el-table-column>
										<el-table-column property="goodsName" label="货品名称" width="200">
										</el-table-column>
										<el-table-column property="goodsNumber" label="货品数量"></el-table-column>
									</el-table>
									<div slot="footer" class="dialog-footer">

										<el-button @click="dialogFormVisible = false">取 消</el-button>
										<el-button type="primary" style="float: right;" plain @click="handleStockIn"
											icon="el-icon-document-checked">入库</el-button>
									</div>

								</el-dialog>


							</div>
						</div>



						<!--表单区域-->
						<el-card>
							<el-table :data="tableData" stripe style="width: 100%; ">
								<el-table-column prop="orderId" label="订单编号" width="180">
								</el-table-column>

								<el-table-column prop="orderStartTime" label="订单开始时间">
								</el-table-column>
								<el-table-column prop="orderEndTime" label=订单结束时间>
								</el-table-column>

								<el-table-column prop="orderInit" label="订单创建人" :formatter="formatInit">
								</el-table-column>
								<el-table-column prop="orderOperator" label="订单操作员">
								</el-table-column>
								<el-table-column prop="orderStatus" label="订单状态" :formatter="formatStatus">
								</el-table-column>
								<el-table-column label="操作" width="250" style="display: flex;">
									<template slot-scope="scope" v-for="orders in tableData">

										<el-button type="primary" plain @click="viewClick(scope.$index)"
											icon="el-icon-info">查看详情</el-button>
										<!--<el-button type="success" plain @click="handleStockIn(scope.$index)" icon="el-icon-delete">入库</el-button>-->
									</template>
								</el-table-column>
							</el-table>
							<div style="text-align: center;">
								<el-pagination background layout="prev, pager, next" :total="1000"></el-pagination>
							</div>
						</el-card>
					</el-main>
				</el-container>
			</el-container>
		</div>
	</body>
	<script src="../../assets/js/vue.js"></script>
	<script src="../../assets/css/element-ui/index.js"></script>
	<script src="../../assets/js/axios.min.js"></script>

	<script>
		new Vue({
			el: '#app',
			data: function() {
				return {
					tableData: [],
					dialogFormVisible: false,
					dialogFormTitle: "查看订单详情",
					gridData: []
				}
			},

			created() {
				this.getAll();
			},

			methods: {
				getAll() {
					//console.log("orderType:{}",orderType);
					axios.get("http://localhost:8080/orders/getByType?orderType=1&orderStatus=11").then(res => {
						this.tableData = res.data;
						/*console.log(this.tableData);*/
					});
				},



				viewClick(index) {
					this.dialogFormVisible = true;
					var orderId = this.tableData[index].orderId;
					axios.get("http://localhost:8080/stockIn/getByOrderId?orderId=" + orderId).then(res => {
						this.gridData = res.data;
						console.log(this.gridData);
					});
				},

				handleStockIn() {
					var goodsName = this.gridData[0].goodsName;
					var goodsNumber = this.gridData[0].goodsNumber;
					console.log(goodsNumber);
					axios.put("http://localhost:8080/inventory/stockIn?goodsName=" + goodsName + "&goodsNumber=" +
						goodsNumber).then(res => {
						if (res.data) {
							this.$message({
								type: 'success',
								message: '入库成功!'
							});
							this.getAll();
							this.dialogFormVisible = false;

						} else {
							this.$message({
								type: 'info',
								message: '入库失败'
							});
						}
					})
				},

				formatStatus(row) {
					switch (row.orderStatus) {
						case 10:
							return "未入库"
							break
						case 11:
							return "入库中"
							break
						case 12:
							return "已入库"
							break
						case 20:
							return "未出库"
							break
						case 21:
							return "出库中"
							break
						case 12:
							return "已出库"
							break
						default:
							return "未知"
							break
					}
				},

				formatInit(row) {
					if (row.orderInit === 11) {
						return "管理员Anna"
					} else {
						return "未知"
					}
				}
			}
		})
	</script>
</html>
